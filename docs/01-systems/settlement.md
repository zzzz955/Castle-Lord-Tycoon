# 정착지(마을 & 요새) 시스템

## 개요
- 정착지는 필드 탐험 중 점령하거나 개방한 마을과 요새를 의미하며, 휴식·거래·장비 관리·파티 관리를 담당한다.
- 모든 상호작용은 NPC 서비스를 통해 이뤄지며, 전투와 직접 연결된 기능은 `docs/01-systems/world-exploration.md`의 탐험 흐름과 연동된다.
- 마을은 탐험 거점, 요새는 전투/보스 거점 역할을 하며 둘 모두 아래의 공용 서비스 구조를 공유한다.

## 정착지 종류
| 구분 | 설명 | 대표 기능 |
| --- | --- | --- |
| 마을(Town) | 필드 거점, 초기 마을 포함 | 여관, 술집, 상점, 대장간, 이동 |
| 요새(Fortress) | 보스/도전 콘텐츠 거점 | 전투 진입, 전용 상점/대장간, 이동 |

> 점령 규칙과 속성 상성 등 탐험 관련 내용은 `docs/01-systems/world-exploration.md` 참고.

## NPC 서비스 요약
| NPC | 기능 | 현재 상태 |
| --- | --- | --- |
| 술집 (Tavern) | 영웅 모집, 전투 프리셋 편집 | 상세 기획 예정 (별도 문서 예정) |
| 상점 (Shop) | 장비/보석/소비품 구매 및 판매 | 상세 기획 예정 (별도 문서 예정) |
| 여관 (Inn) | 파티 영웅 HP 즉시 회복 | 본 문서에서 확정 |
| 대장간 (Forge) | 장비 제작/분해/각인 해제 | 상세 기획 예정 (별도 문서 예정) |
| 이동 (Waypoint) | 점령한 마을/요새 간 즉시 이동 | 본 문서에서 개요 제공 |

## 서비스 상세

### 1. 여관 (Inn)
- 전투 프리셋에 등록된 현재 파티원의 HP를 즉시 최대치까지 회복한다.
- 쿨타임, 소모 재화 제한이 없으며 플레이어가 원할 때 언제든 사용 가능하다.
- 요새에서도 동일 규칙을 따르되, 여관 NPC가 없는 경우(보스 요새 등)에는 이동 NPC 인근에서 회복 기능을 제공하는 UI 버튼을 노출한다.

### 2. 이동 (Waypoint)
- 점령한 마을/요새 목록을 탭으로 구분해 노출하고, 선택 시 해당 거점으로 즉시 이동한다.
- 이동 완료 시 선택한 거점의 이동 NPC 앞에 파티가 배치된다.
- 이동에는 소모 재화가 없으며, 추후 난이도에 따라 긴급 이동 비용을 추가할 여지를 남긴다(Stub).

### 3. 술집 (Tavern) – Stub
- 영웅 모집, 프리셋 저장/불러오기, 영웅 방출 UI를 담당한다.
- 재화 구조, 드랍 확률, 인터페이스는 별도 문서(`docs/01-systems/tavern.md` 예정)에서 정의한다.

### 4. 상점 (Shop) – Stub
- 장비, 보석, 보호석 등 주요 아이템을 판매/회수한다.
- 카테고리(일반/주간/계급), 재고 리셋, 가격 정책을 `docs/01-systems/shop.md`에서 정리할 예정.

### 5. 대장간 (Forge) – Stub
- 장비 제작/분해, 보석 각인 해제 등을 처리한다.
- 제작 레시피와 분해 보상, 보석 해제 비용은 `docs/01-systems/forge.md`에서 상세 기획 예정. 현재는 보석 해제 = 장비 분해 규칙만 확정.

## 데이터 구조 (제안)
| 파일 | 용도 |
| --- | --- |
| `settlement_templates.csv` | 정착지 ID, 타입, 기본 서비스 목록 |
| `npc_services.csv` | 서비스 ID, 이름, 관련 NPC, 서비스 타입 |
| `settlement_npc_map.csv` | 정착지 ↔ NPC 매핑 |
| `shop_inventory.csv` | 상점 판매 품목 (상세 기획 후 확정) |
| `tavern_pools.csv` | 영웅 모집 테이블 (기획 예정) |

## 연관 문서
- `docs/01-systems/world-exploration.md`: 정착지 점령, NPC 인터랙션 흐름.
- `docs/01-systems/character.md`: 영웅 기본 능력치, 파티 구성.
- `docs/01-systems/equipment.md`: 장비 강화/보석 각인, 대장간 서비스 연계.
- `docs/01-systems/gems.md`: 보석 슬롯 해금, 드랍, 조합 규칙.

## Stub / 남은 과제
1. 술집(영웅 모집), 상점(판매/재고), 대장간(제작/분해) 상세 문서 작성.
2. 정착지 템플릿 및 NPC 매핑 CSV 구조 확정.
3. 이동 서비스에 유료 옵션(긴급 이동, 장거리 이동 제한) 도입 여부 검토.
4. UI 와이어프레임: 정착지 맵, NPC 목록, 서비스 패널.

---
**최종 수정**: 2025-10-23  
**상태**: 개편  
**작성자**: SangHyeok  
