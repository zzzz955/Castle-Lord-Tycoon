# 적(Enemy) 시스템 기획서

## 개요
- 적은 전투에서 아군과 맞서는 모든 기물을 의미하며, **영웅과 동일한 데이터 포맷**(타입, 속성, 성장치, 고유 효과)을 재사용한다.
- 구성 전략은 Option C:  
  - **필드**: 주로 몬스터 테마(슬라임, 워베어 등). 최소한의 공용 리소스로 시작해 추후 확장.  
  - **요새/보스**: 영웅 템플릿(4~6성)과 고유 효과를 그대로 활용하여 난이도와 개성을 부여한다.
- 영웅과 동일한 능력치 공식/고유 효과 템플릿을 사용하므로 전투/밸런스 시스템이 단순화된다.
- 적은 장비를 착용하지 않으므로, **성장치 + 스탯 보정 배율**을 통해 난이도를 조절한다.
- 몬스터 아트/리소스는 장기적으로 확보 예정이며, 초기에는 Stub 상태로 운용하면서 영웅형 적을 중심으로 진행한다.

## 1. 데이터 구조
### 1.1 적 템플릿 (`enemy_templates.csv`)
| 컬럼 | 설명 |
| --- | --- |
| `enemy_id` | 적 ID |
| `name_token_ko` | 이름(한글 기본 + 로컬라이즈 키) |
| `visual_id` | 공용 `unit_visuals` 테이블을 참조하는 아트 ID(영웅/몬스터 구분 플래그 포함) |
| `type` | 공격형/방어형/균등형 |
| `attribute` | 물/불/땅/무 |
| `base_level` | 기본 레벨 |
| `base_growth` | 성장치(G) |
| `unique_effect_ids` | 고유 효과 ID 배열 |
| `base_exp` | 기본 경험치 |
| `drop_table_id` | 드랍 테이블 참조 |
| `tags` | `field`, `fortress`, `boss` 등 태그 |

### 1.2 스탯 보정 배율 (`enemy_stat_modifiers.csv`)
| 컬럼 | 설명 |
| --- | --- |
| `modifier_id` | 배율 ID |
| `attack_scale` | 공격력 배율 |
| `defense_scale` | 방어력 배율 |
| `hp_scale` | 체력 배율 |
| `crit_rate`, `crit_damage`, `armor_penetration`, `damage_reduction` | 필요 시 추가 |
| `description` | 주석/설명 |

### 1.3 등장 설정 (`enemy_encounters.csv`)
| 컬럼 | 설명 |
| --- | --- |
| `field_id` | 필드/요새 ID |
| `enemy_id` | 참조 |
| `level` | 해당 필드에서 적용할 레벨(없으면 `base_level`) |
| `modifier_id` | 적용할 스탯 배율 |
| `spawn_rate` | 등장 확률(%) |
| `drop_table_override` | 드랍 테이블 덮어쓰기(필요 시) |
| `notes` | 설계 주석 |

### 1.4 드랍 테이블 (`enemy_drop_tables.csv`)
| 컬럼 | 설명 |
| --- | --- |
| `drop_table_id` | 드랍 ID |
| `item_id` | 드랍 아이템/골드 |
| `drop_rate` | 드랍 확률(기본값 × 파티 보정) |
| `amount_min`, `amount_max` | 드랍 수량 범위 |
| `type` | `exp`, `gold`, `item`, etc. |

## 2. 능력치 및 속성
- **기본 능력치 공식**: 영웅과 동일(타입 + 성장치). 적도 `공/방/체/크확/크뎀/방무/피해 감소율`을 사용한다.
- **속성 상성**: 물 → 불 → 땅 → 물, ±30% 최종 피해 보정. 무속성은 영향 없음.
- 적의 `growth` 값과 `modifier` 배율을 조합해 필드별 난이도를 조정한다.
- 필요 시 `unique_effects`로 추가 행동(회피, 강화 등)을 부여한다.

## 3. 등장 규칙
- **필드 몬스터**  
  - 몬스터 테마(슬라임, 임프 등)를 최소 리소스(색상 변형 등)로 구현.  
  - 고유 효과 없이 기본 능력치 또는 간단한 효과로 시작.
- **상위 필드/요새**  
  - 영웅 템플릿(4~6성)을 재활용해 고유 효과를 포함한 강한 적 구성.  
  - 요새는 기본 무속성/보스 전용 템플릿을 사용하거나, 특정 영웅 보스를 배치.
- `enemy_encounters.csv`에서 필드별로 레벨/배율/드랍 테이블만 교체하면 재활용이 가능하다.

## 4. 드랍/보상 설계
- **경험치**: `base_exp`를 적마다 지정하고, 필드/난이도별로 multiplier 적용. 같은 레벨이라도 난이도에 따라 경험치 차등 지급 가능.
- **골드/재화/전리품**: 기본 드랍률을 골드 20%, 보호석 20%, 영웅 파편 20%로 확정하고, 필드별로 필요 시 조정한다. 파티 드랍률 증가 수치와 곱하며, 드랍 수량은 드랍 테이블(`enemy_drop_tables.csv`)에서 정의한다.
- 다른 전리품은 추후 추가 가능하며, `enemy_drop_tables.csv`에 항목을 추가하는 방식으로 확장한다.

## 5. 전투 연출 및 UI
- 피아 식별은 그리드(좌측=아군, 우측=적)로 명확히 하고, **타입/속성 아이콘**을 적 초상화에 추가해 속성/역할을 표시한다.
- 네이밍 정책: 필드 몬스터는 “슬라임”, “워베어” 등 판타지형, 요새 보스는 “적 영웅” 스타일을 따로 명명. 로컬라이즈 키 사용.
- **비주얼 참조**: 모든 유닛(영웅/몬스터)은 공용 `unit_visuals` 테이블을 사용하며, 각 행에 `unit_type` 플래그와 필요한 아트 메타데이터를 기록한다. 적이 영웅일 경우 기존 영웅 리소스를 그대로 참조하고, 몬스터는 해당 테이블에서 Stub 상태의 리소스를 사용한다.
- 로그/연출에서 적 영웅의 고유 효과 발동은 영웅과 동일한 방식으로 처리한다.

## 6. 밸런싱 가이드
- **1차 조정**: `base_growth`, `base_level`로 미세 조정.  
- **2차 조정**: `enemy_stat_modifiers` 배율로 필드/요새 전체 난이도 일괄 조정.  
- **특수 행동**: 영웅과 동일한 고유 효과를 기본으로 사용하며, 요새 보스는 해당 영웅 고유 효과 리스트를 그대로 재사용한다(필요 시 추가 템플릿을 별도 작성).
- **특수 행동**: 고유 효과(`hero-unique-effects.md`)를 적에게도 적용. 예: `on_hit` + `dodge_chance`.
- **테스트 절차**:  
  1. 필드별 레벨/성장치 세팅 →  
  2. 스탯 배율 적용 →  
  3. 전투 시뮬레이션으로 평균 전투 길이, 파티 HP 감소율 체크 →  
  4. 드랍 테이블 수익/경험치 기대값 검증.

## 7. Stub / 남은 과제
1. 필드 몬스터 최소 리소스 리스트 확정(AI 생성 기준 포함).  
2. 드랍 테이블(골드/보호석/영웅 파편) 수량 밸런스 산출.  
3. 적 전용 이름·설명 로컬라이즈 테이블 확립.  
4. 테스트 자동화 스크립트(전투 리플레이/경험치 수익 체크) – 장기 과제로 유지.

---
**최종 수정**: 2025-10-23  
**상태**: 초안  
**작성자**: SangHyeok  
