# 대장간(Forge) 시스템 기획서

## 1. 개요
- 대장간은 장비 강화, 분해, 보석 각인, 옵션 변경, 장비 합성을 제공하는 통합 관리 시설이다.
- UI 구조: 좌측에 보유 장비 목록을 공통으로 노출하고, 상단 탭(강화/분해/보석 각인/옵션 변경/장비 합성)을 선택하면 해당 기능 영역의 패널이 활성화된다.
- 장비를 선택하면 현재 탭에서 사용하는 대상 장비로 설정되며, 각 탭의 상세 정보와 컨펌 모달을 통해 작업을 수행한다.
- 모든 행동은 서버 검증을 거치며, 결과(성공/실패)와 자원 차감, 전투력 갱신을 즉시 반영한다.

## 2. 공통 UI/UX
1. 장비 목록(필터/정렬): 장비 부위, 등급, 강화 단계 등 필터와 전투력/등급 정렬 지원.
2. 장비 선택 시 해당 탭에 맞는 정보 패널을 우측에 노출한다.
3. 작업 버튼을 누르면 컨펌 모달을 띄워 성공/실패 조건, 소모 재화, 회복 불가 사항(예: 제물 파괴, 보석 반환 불가 등)을 명시한다.
4. 모든 모달에는 “확인/취소” 버튼이 있어야 하며, 실패 시 후속 안내(예: 강화 실패 시 단계 하락) 문구를 포함한다.

## 3. 기능별 상세

### 3.1 장비 강화
- 선택된 장비의 강화 단계를 올리는 기능. 강화 규칙은 `docs/01-systems/equipment.md`를 따른다.
- 패널에 표시할 정보:
  - 현재 강화 단계 / 최대 20강.
  - 강화 성공 확률(구간별 100%/50%/30%/10%).
  - 필요 골드, 보호석 보유 수, 보호석 사용 여부 토글.
  - 예상 능력치 상승치(1.1배 누적) 및 실패 시 단계 하락 안내.
- 보호석 미사용 시 실패하면 단계가 1 하락한다. 모달에서 이를 재확인시킨다.

### 3.2 장비 분해
- 선택된 장비를 분해하고, 장착된 보석을 전부 반환한다.
- 분해 비용은 없다(장비 소멸 & 보석만 반환). 추가 재화 회수 없음.
- 패널에 표시할 정보:
  - 장착된 보석 목록(각 슬롯별).
  - 분해 결과: 장비 소멸/보석 반환 안내.
- 서버는 분해 후 장착된 보석을 인벤토리로 돌려주고, 장비를 삭제한다.

### 3.3 보석 각인
- 선택된 장비에 보석을 장착하거나 해제, 슬롯 해금 작업을 수행한다.
- 표시 정보:
  - 현재 각인 상태(슬롯별 보석/빈 슬롯).
  - 잠긴 슬롯: 해금 비용(골드) 및 필요 조건 표시.
  - 장착 가능한 보석 목록(장비 부위와 색상 매칭).
  - 각 보석 장착/해제 버튼, 슬롯 해금 버튼.
- 각 행동마다 컨펌 모달을 표시해 자원 차감/보석 제거 여부를 확인한다.

### 3.4 옵션 변경 (Re-roll)
- UC 등급 이상 장비에서만 사용 가능. C 등급은 추가 옵션이 없으므로 옵션 변경 대상에서 제외.
- 패널에 표시할 정보:
  - 현재 부여된 추가 옵션 목록(옵션 타입, 수치).
  - 변경할 옵션 선택 UI(체크박스 등으로 1개 선택).
  - 보유 “옵션 변경권” 개수 및 필요 수량(보통 1개).
- 옵션 변경을 실행하면 선택한 옵션이 공/방/체/크확/크뎀/방무/피해 감소 중 하나로 랜덤 재부여된다(동일 옵션이 다시 나올 수 있음).
- 옵션 변경권은 필드 드랍/공용 상점에서 구매 가능하도록 다른 문서와 연동한다.

### 3.5 장비 합성
- 동일 부위/동일 레벨/동일 등급/동일 장비 ID의 장비 2개(기본 장비 + 제물)를 합성해 상위 등급 장비로 승급시키는 기능.
- 입력 조건:
  - 선택 장비와 제물 장비는 완전히 동일해야 한다.
  - 제물 장비는 장착된 보석을 포함한 상태로 합성 가능하지만, 실패 시 보석과 장비 모두 소멸한다.
- 출력:
  - 성공 시 선택 장비는 동일 레벨의 상위 등급으로 상승하며 기본 수치, 부가 옵션, 강화 단계가 상위 등급 기준으로 재보정된다.
  - 실패 시 제물만 소멸하고 선택 장비는 유지된다. (제물에 보석이 있었던 경우 복구 불가 경고 모달 제공.)
- 합성 확률과 골드 비용은 등급별로 정의한다(예: C→UC, UC→R, R→H, H→L). `forge_synthesis_rules.csv`에 관리.
- 성공/실패 여부는 서버가 판정하고, 결과와 능력치 재계산을 즉시 반영한다.

## 4. 데이터 구조 제안
| 파일 | 설명 |
| --- | --- |
| `forge_upgrade_rules.csv` | 강화 성공 확률, 보호석 사용 여부 |
| `forge_decompose_rules.csv` | 분해 처리(현재는 장비 소멸 & 보석 반환, 확장 여지) |
| `forge_socket_unlock.csv` | 슬롯 해금 비용 (장비 문서와 연동) |
| `forge_option_change.csv` | 옵션 변경권 소모량, 후보 옵션 풀 |
| `forge_synthesis_rules.csv` | 합성 확률, 골드 비용, 등급 관계 |

## 5. UI 흐름 요약
- 탭 전환 → 장비 선택 → 정보 확인 → 작업 버튼 → 컨펌 모달 → 서버 요청 → 결과 표시.
- 실패 시(강화 실패, 합성 실패) 상세 결과 팝업을 별도로 제공해 플레이어에게 손실 요소를 명확히 전달한다.

## 6. Stub / 남은 과제
1. 합성 성공 확률 및 골드 비용 확정.
2. 옵션 변경권 드랍/상점 공급 수량 및 확률 정의.
3. 보석 슬롯 해금 비용(슬롯 2~6) 확정 및 UI 와이어프레임 작성.
4. 합성 실패 시 로그/이펙트 연출 설계.
5. 탭별 튜토리얼/가이드(처음 이용 시) 제공 여부 검토.

---
**최종 수정**: 2025-10-23  
**상태**: 초안  
**작성자**: SangHyeok  
