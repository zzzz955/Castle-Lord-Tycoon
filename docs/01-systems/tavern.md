# 술집(Tavern) 시스템

## 1. 개요
- 술집은 영웅을 모집하고 파티 프리셋을 관리하는 핵심 NPC 서비스이다.
- 모든 마을(요새 포함)에 술집 NPC가 배치되며, 플레이어는 이와 상호작용해 영웅 모집/관리 기능을 사용한다.
- 영웅 모집은 세 단계(일반/고급/최고급)로 구성되며, 무료 갱신 시간과 쿠폰 사용으로 운영된다.

## 2. 영웅 모집 탭

### 2.1 일반 영웅 모집
- 무료 갱신 주기: 3시간. 마지막 모집 시점으로부터 3시간 후 재사용 가능.
- 등장 성급: 1~4성.
- 출현 확률: 1성 50%, 2성 30%, 3성 17%, 4성 3%.
- 조건: 영웅 보유 슬롯에 최소 1자리 이상 여유가 있어야 사용 가능.

### 2.2 고급 영웅 모집
- 무료 갱신 주기: 24시간.
- 등장 성급: 2~6성.
- 출현 확률: 2성 50%, 3성 30%, 4성 18%, 5성 1.5%, 6성 0.5%.
- 조건: 영웅 보유 슬롯에 최소 1자리 이상 여유가 있어야 사용 가능.

### 2.3 최고급 영웅 모집
- 무료 갱신 주기: 72시간.
- 무료 사용 시 한 번에 10명의 영웅을 획득한다.
- 등장 성급: 3~6성.
- 출현 확률: 3성 70%, 4성 25%, 5성 4%, 6성 1%.
- 조건: 영웅 보유 슬롯에 최소 10자리 여유가 필요.

### 2.4 영웅 모집 쿠폰
- 쿠폰 종류: 일반, 고급, 최고급.
- 골드 가격: 100 / 1,000 / 20,000.
- 희박한 확률로 몬스터 드랍(필드 드랍 테이블에 추가 예정).
- 무료 모집 기회가 남아 있으면 쿠폰보다 무료 모집이 우선 사용된다.
- 계정 생성 시 일반 영웅 모집 쿠폰 3장을 지급한다.
- 쿠폰 보유 수량, 사용 이력은 서버에서 검증/관리한다.

### 2.5 영웅 보유 슬롯
- 영웅 보유 최대치에 여유가 없어 모집이 불가능하면, 추가 골드를 지불해 슬롯을 확장할 수 있다.  
- 확장 비용/구간은 `hero_pool_expansion_rules.csv`(Stub)에서 정의 예정.

### 2.6 데이터 제안
| 파일 | 컬럼 예시 | 설명 |
| --- | --- | --- |
| `tavern_recruitment_tiers.csv` | `tier`, `free_cooldown_hours`, `hero_star_min`, `hero_star_max`, `star_distribution`, `free_batch_size` | 모집 단계 정의 |
| `tavern_coupon_prices.csv` | `tier`, `gold_cost`, `drop_rate` | 쿠폰 가격 및 드랍 |
| `hero_pool_expansion_rules.csv` | `slot_cap`, `gold_cost` | 슬롯 확장 규칙(Stub) |
| `hero_drop_tables.csv` | `table_id`, `hero_id`, `weight` | 성급별 영웅 목록 |

## 3. 영웅 탭

### 3.1 보유 영웅 목록
- 보유 영웅을 1×1 초상화 형태로 리스트 노출.
- 정렬 옵션: 레벨, 속성, 전투력, 성급. 마지막 사용 정렬 값을 로컬 캐시하여 유지.
- 영웅 선택 시 상세 보기/방출/취소 버튼을 노출하며, UI 패널이 화면 밖으로 벗어나지 않도록 제한한다.

### 3.2 영웅 상세 보기
- 2×3 카드 레이아웃으로 영웅 이미지, 기본 스탯, 타입, 속성, 장비 슬롯, 고유 효과 목록을 표시.
- 장비 슬롯을 터치하면 장비 목록을 무기/모자/갑옷/신발/악세서리 탭으로 나누어 보여 준다.  
- 장비 목록은 기본 정렬 기준을 전투력(공격력 우선)으로 설정하고, 필요 시 다른 정렬 옵션 추가.
- 장비 장착 프로세스:
  1. 장착 대상 장비 선택 → 장착 가능 여부 확인(타입/속성 제약).
  2. 장착 확인 모달 표시.
  3. 다른 영웅이 이미 장착 중인 경우 “{영웅 이름}이 장착 중입니다. 옮기시겠습니까?” 모달 표시 후 확인 시 기존 영웅에서 해제하고 현재 영웅에게 장착.
  4. 모든 장착/해제는 서버 검증을 거쳐 전투력을 즉시 갱신한다.

### 3.3 영웅 방출
- 선택한 영웅을 방출하면 등급에 따라 “영웅 파편”을 획득한다.
- 장비를 하나라도 착용 중이면 “장비를 해제해야 방출할 수 있습니다” 경고 모달을 표시하고, 장비를 모두 해제한 뒤에만 방출이 가능하다.
- 방출 시 영웅 파편 수량은 `hero_release_rewards.csv`를 참조한다.

## 4. 파티 프리셋 탭
- 기본 제공 프리셋: 1개.
- 추가 프리셋 최대 4개(총 5개)까지 확장 가능. 해금 비용: 2번째 500골드, 3번째 2,000골드, 4번째 10,000골드, 5번째 50,000골드.
- 프리셋 해금 시 즉시 전투력 순으로 정렬된 상위 4명의 영웅이 자동 배치된다.
- 각 프리셋은 1~4명의 영웅을 편성할 수 있으며, 필드 탐험 중 적을 조우하면 현재 활성화된 프리셋이 사용된다.
- 프리셋 저장/불러오기 변경 사항은 서버에 동기화된다.

## 5. 추가 고려 사항 / Stub
1. 영웅 모집 결과에 따른 애니메이션/FX 연출.
2. 쿠폰 드랍 확률 및 필드/요새별 드랍 테이블 정의.
3. 영웅 보유 슬롯 최대치 및 확장 한계치(상한) 결정.
4. 자동 방출/정렬 기능(필요 시)과 관련된 UX 설계.

---
**최종 수정**: 2025-10-23  
**상태**: 초안  
**작성자**: SangHyeok  
