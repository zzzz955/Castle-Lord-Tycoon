# 상점 시스템 기획서

## 1. 개요
- 상점은 마을에서만 이용 가능한 NPC 서비스로, 장비와 공용 소비재(보석, 보호석, 영웅 파편 등)를 판매한다.
- 요새에는 상점 NPC가 존재하지 않는다.
- 상점 품목은 UTC+9 기준 매일 0시/6시/12시/18시에 갱신된다.
- 플레이어는 어느 마을에서 접근하든 동일한 갱신 시간을 공유하지만, 각 마을 상점은 독립된 장비 슬롯을 유지한다.

## 2. 상점 구조
상점은 세 개의 탭(장비/공용/깃발)으로 구성된다.

### 2.1 장비 탭 (마을별 전용 슬롯)
- 각 마을 상점은 장비 슬롯 5개를 보유한다.
- 갱신 시 슬롯마다 랜덤 장비 1개를 배치하며, 플레이어가 구매하면 해당 슬롯은 품절 상태로 유지되고 다음 갱신 때까지 재입고되지 않는다.
- **장비 부위**: 무기, 모자, 갑옷, 신발, 목걸이, 반지, 벨트가 동일 확률(각 1/7)로 등장한다.
- **등급 분포**: C 75%, UC 20%, R 4%, H 1%. (L 등급은 상점 판매에서 제외)
- **정착지별 장비 레벨 범위**: 각 마을/요새의 티어에 따라 등장 장비 레벨 범위가 정해진다(예: 초기 거점=Lv1~35, 중기 거점=Lv36~64, 상위 거점=Lv65~99 등). 플레이어 진행도에 따라 상위 마을에 접근하면 더 높은 레벨의 장비를 구매할 수 있다.
- 장비별 가격은 `shop_equipment_prices.csv`에서 장비 레벨/등급 기준으로 정의한다(Stub).
- 구매는 마을별 독립이므로, 여러 마을을 방문하면 각자의 남은 슬롯을 확인할 수 있지만 **슬롯 수는 5개로 제한**된다.

### 2.2 공용 탭 (계정 전역 공유)
- 공용 슬롯 10개는 모든 마을이 공유하며, 플레이어가 어느 마을에서든 동일 목록을 본다.
- 갱신 시 공용 슬롯이 재입고되며, 플레이어가 품목을 구매하면 전역에서 품절 처리된다.
- **아이템 종류와 확률**  
  - 보석: 10% (부위별 확률 동일, C~H 등급 분포는 장비와 동일)  
  - 보호석: 20%  
  - 영웅 파편: 70%  
  - 추후 추가 물품을 위해 `shop_shared_pool.csv`에 아이템 타입/확률을 추가할 수 있는 구조로 설계한다.
- 보석/보호석/영웅 파편의 가격은 `shop_shared_prices.csv`에서 정의한다(Stub).

### 2.3 깃발 탭
- 플레이어 계급에 따라 구매 가능한 깃발 목록을 노출한다.
- 항목마다 크기, 가격, 요구 계급, 보유 수량(사용 중 포함), 구매 가능 한도를 표시한다.
- 구매 제한: 계급이 허용하는 수량 내에서 구매 가능하며, 구매 후 깃발 인벤토리에 즉시 반영된다.
- 깃발 판매 기능: 플레이어는 보유 깃발을 25% 가격으로 판매할 수 있으며, 설치 중인 깃발을 판매하려면 먼저 제거해야 한다.
- 상점 탭 상단에 현재 계급과 보유 골드를 함께 노출해 접근성 향상.

## 3. 갱신 및 상태 관리
- 서버는 UTC+9 기준 0/6/12/18시마다 각 상점 슬롯을 재생성하고, 해당 시각 이후 상점에 접근한 플레이어에게 갱신된 목록을 전달한다.
- 장비 탭 품목은 마을별 독립, 공용 탭 품목은 계정 전역 공유이다.
- 품목 구매 여부는 서버에서 체크하며, 클라이언트는 품절 상태를 즉시 반영한다.

## 4. 데이터 테이블 제안
| 파일 | 설명 |
| --- | --- |
| `shop_equipment_pool.csv` | 장비 탭 품목 풀(등급/부위/레벨 범위) |
| `shop_equipment_prices.csv` | 장비 가격(레벨/등급별) |
| `shop_shared_pool.csv` | 공용 탭 품목 및 출현 확률 |
| `shop_shared_prices.csv` | 공용 아이템 가격 |
| `shop_refresh_schedule.csv` | 갱신 시각(기본 값: UTC+9 0/6/12/18) |
| `shop_flag_inventory.csv` | 깃발 판매 목록, 계급 요구 사항 |

## 5. UI/UX
- 상점 메뉴는 장비/공용 탭으로 구성하고, 각 슬롯에 품목 이미지, 이름, 등급, 가격, 갱신까지 남은 시간을 표시한다.
- 장비 탭에는 “이 마을에서만 판매” 안내 문구, 공용 탭에는 “전역 공유” 안내 문구를 표기해 혼동을 줄인다.
- 품절된 슬롯은 비활성화 상태로 표시하고 다음 갱신 예정 시간을 보여 준다.
- 갱신 시 자동 새로고침 애니메이션 또는 팝업을 제공해 사용자 경험을 향상시킨다(선택).

## 6. Stub / 남은 과제
1. 장비/공용 아이템 가격 테이블 확정.
2. 보석/영웅 파편 등 공용 품목 추가 후보 및 확률 조정.
3. 갱신 로그/알림(푸시 또는 UI) 여부 결정.
4. 상점 접근 시 쿠폰/보유 골드 부족 상황에 대한 UX 메시지 정의.

---
**최종 수정**: 2025-10-23  
**상태**: 초안  
**작성자**: SangHyeok  
