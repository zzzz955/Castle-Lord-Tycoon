# 월드 탐험

## 목적
- 거점과 필드를 왕복하며 전투와 영토 확장을 반복하는 핵심 루프를 제공한다.
- 필드마다 몬스터 테이블과 요새 전투를 통해 진행 난도를 조절한다.
- 서버는 탐험 상태를 권한 있게 추적하고, 클라이언트는 2D 아이소메트릭 월드를 8방향 이동으로 시각화한다.

## 탐험 단계 요약
1. **거점 준비**: 마을에서 파티·장비를 정비하고 필드로 출발한다.
2. **튜토리얼 구역**: 첫 깃발 설치 전까지는 전투가 발생하지 않는다.
3. **필드 순찰**: 타일 이동마다 독립 확률로 전투가 발생한다.
4. **전투 진행**: 서버가 전투를 계산하고 클라이언트는 로그를 재생한다.
5. **영토 확장**: 깃발과 건물을 설치해 영토를 늘린다.
6. **휴식/귀환**: 캠핑 또는 마을 귀환으로 체력을 회복한다.

## 지형 구조
| 구역 | 설명 | 기본 특성 |
| --- | --- | --- |
| 마을 | 플레이어 거점, NPC 허브 | 조우 없음, 서비스 이용, 영토 연결 시 소유 |
| 필드 | 마을과 요새 사이의 탐험 지대 | 타일 이동 시 10% 전투 조우 |
| 요새 | 고정 배치 보스 구역 | 첫 승리 전까지 전투 강제 |

## 이동과 시야
- 이동 입력은 8방향 클릭/터치 기반이다.
- 이동 속도는 지형, 날씨, 파티 중량 등 외부 요인으로 보정된다.
- 시야 상태는 `미탐색 → 탐색됨 → 영토 보유` 3단계로 구분되며, 깃발은 인접 타일을 밝힌다.
- 타일을 변경하지 않고 머무르는 동안에는 전투 조우가 발생하지 않는다.

### 이동 동기화
- 클라이언트는 타일을 이동할 때마다 WebSocket으로 “현재 좌표 → 다음 좌표” 이벤트를 서버에 전송한다.
- 서버는 이벤트를 검증해 인메모리에 최신 좌표를 저장하고, 즉시 10% 전투 판정을 수행한다.
- 전투가 발생하면 그 결과(적 편성, 전투 로그)를 WebSocket으로 내려주고, 전투는 `docs/01-systems/combat.md` 규칙을 따른다.
- 서버 인메모리에 저장된 좌표는 5초 주기로 DB에 flush하고, 클라이언트도 5초마다 레이지 싱크로 좌표를 복구한다.
- 현재는 단일 서버 환경을 전제로 하며, 수평 확장이 필요할 경우 Redis 등 캐시 계층 도입을 검토한다.

## 전투 조우
- 타일 이동 시 독립 확률(10%)로 전투가 발생한다.
- 적 편성은 `docs/01-systems/enemy.md`의 템플릿과 드랍 테이블을 참조한다.
- 전투는 속성 상성, 20라운드 제한 등 `docs/01-systems/combat.md` 규칙을 따른다.
- 요새 및 스토리 전투는 강제 전투로 처리한다.

## 캠핑과 귀환
- 필드 어디에서든 캠핑을 시작해 체력을 회복할 수 있으며, 캠핑 중에는 전투가 발생하지 않는다.
- 캠핑은 5초마다 최대 체력의 10%를 회복하며, 필요 시 즉시 종료 가능하다.
- 마을 귀환은 제한 없이 가능하며, 쿨다운과 비용은 없다.

## 영토 확장
- 깃발 설치는 `docs/01-systems/territory.md`를 따른다(3×3~9×9, 가격/계급 조건).
- 설치된 영토는 계급 보너스(`docs/01-systems/progression.md`)와 연계된다.

## 데이터 메모 (MVP 범위)
- `enemy_encounters.csv`: 필드별 적 구성, 전투 발생 정보.
- `flag_templates.csv`, `flag_inventory.csv`: 깃발 관리.
- 이벤트/자원 조우 CSV는 미생성(MVP 비대상).

## 기술 고려 사항
- 서버가 이동, 조우, 시야를 authoritative하게 처리하고, 클라이언트 입력은 검증 후 반영한다.
- 주요 API: `/world/encounter/resolve`, `/combat/start`, `/territory/flag`.
- 관련 명령(이동, 깃발 설치, 캠핑, 귀환 등)은 `client-server-contract.md`에서 정의한다.

## Stub / 남은 과제
1. 필드 레이아웃과 이동 불가 타일 정의.
2. 필드별 몬스터 테이블 수치 확정.
3. 캠핑 UI/UX 설계.
4. 계급 보너스(영토 기반) 상세 수치 확정.
5. 이벤트/자원 조우 도입 시 확장 계획.

---
**최종 수정**: 2025-10-24  
**상태**: MVP 적용  
**작성자**: SangHyeok
